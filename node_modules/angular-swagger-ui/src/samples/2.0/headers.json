{
    "swagger": "2.0",
    "basePath": "/apimocks/api",
    "host": "dvapjwsc01.rouen.francetelecom.fr",
    "info": {
        "contact": {
            "name": "apiteam-gp@orange.com"
        },
        "description": "API qui a pour but de réaliser le paiement de factures par CB via le canal online et de suivre ces paiements",
        "title": "API FPC Paiement facture par CB",
        "version": "1.0"
    },
    "paths": {
        "/billPaymentStatuses": {
            "get": {
                "description": "Retourne l'état des paiements effectués et les actions pouvant être réalisées par le client",
                "parameters": [
                    {
                        "description": "Identifiant de l’application appelante (exemples: 'NECFE', 'AMP', 'ERB')",
                        "in": "header",
                        "name": "callerId",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "description": "Identifiant unique pour chaque requête permettant la traçabilité des informations de bout en bout et servant lors de l’enregistrement des logs FPC et des partenaires sud. Valeur à l'initiative de l'appelant. (Exemple de valeur générée en java avec la méthode UUID.randomUUID(): '92eaf49d-13cd-4520-b536-2dd0faa5341f')",
                        "in": "header",
                        "name": "traceId",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "description": "WEB, MOB ou identifiant teléconseiller eclair (exemples: 'MOBILE' pour un appel AMP ou NECFE depuis un smartphone, 'WEB' pour un appel NECFE depuis un ordinateur connecté à internet. Pour Eclair: '1101' pour une boutique Orange, '1102' pour le service client, '1103' pour le site orange.fr)",
                        "in": "header",
                        "name": "channel",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "description": "Type identifiant de contrat Orange",
                        "in": "query",
                        "name": "contractKeyType",
                        "required": true,
                        "type": "string",
                        "default": "mobilePhoneNumber",
                        "enum": [
                            "mobilePhoneNumber",
                            "fixedLineNumber",
                            "internetAccount"
                        ]
                    },
                    {
                        "description": "Identifiant contrat Orange (numéro tel mobile, numéro tel fixe, compte internet)",
                        "in": "query",
                        "name": "contractKey",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/CustomerPaymentSummary"
                        }
                    },
                    "400": {
                        "description": "Erreur sur la requête (champs manquants, mauvais paramétrages des données...etc)",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "500": {
                        "description": "Erreur technique/fonctionnelle",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "503": {
                        "description": "Serveur indisponible (maintenance ou nombre d'appels trop important).",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    }
                },
                "summary": "Retourne l'état des paiements effectués et les actions pouvant être réalisées par le client",
                "tags": [
                    "billPaymentStatuses"
                ]
            }
        },
        "/paymentProcesses": {
            "post": {
                "description": "Crée une ressource de suivi du paiement CB d'une facture. Cette ressource contient les données qui seront utiles aux traitements post paiement. Cette opération est appelée par les Frontaux quand le client clique sur le bouton de paiement. Cette opération permettra d'enregistrer le numéro de transaction en BDD FPC suite à l'appel vers EPCB.",
                "parameters": [
                    {
                        "description": "Identifiant de l’application appelante (exemples: 'NECFE', 'AMP', 'ERB')",
                        "in": "header",
                        "name": "callerId",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "description": "Identifiant unique pour chaque requête permettant la traçabilité des informations de bout en bout et servant lors de l’enregistrement des logs FPC et des partenaires sud. Valeur à l'initiative de l'appelant. (Exemple de valeur générée en java avec la méthode UUID.randomUUID(): '92eaf49d-13cd-4520-b536-2dd0faa5341f')",
                        "in": "header",
                        "name": "traceId",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "description": "WEB, MOB ou identifiant teléconseiller eclair (exemples: 'MOBILE' pour un appel AMP ou NECFE depuis un smartphone, 'WEB' pour un appel NECFE depuis un ordinateur connecté à internet. Pour Eclair: '1101' pour une boutique Orange, '1102' pour le service client, '1103' pour le site orange.fr)",
                        "in": "header",
                        "name": "channel",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "description": "Données du body",
                        "in": "body",
                        "name": "paiementFacture",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/PaymentRessourceInit"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Paiement Facture initialisé",
                        "schema": {
                            "$ref": "#/definitions/PaymentInitializationResponse"
                        },
                        "headers": {
                            "Location": {
                                "description": "ID de la ressource",
                                "type": "string"
                            },
                            "Test": {
                                "description": "ID de la ressource",
                                "type": "array",
                                "items": {
                                    "type": "string"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Erreur sur la requête (champs manquants, mauvais paramétrages des données...etc)",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "500": {
                        "description": "Erreur technique/fonctionnelle",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "503": {
                        "description": "Serveur indisponible (maintenance ou nombre d'appels trop important).",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    }
                },
                "summary": "Initialisation d'une ressource de paiement. ",
                "tags": [
                    "paymentProcesses"
                ]
            }
        },
        "/paymentProcesses/{paymentProcessId}/validate": {
            "post": {
                "description": "Suite au paiement du client sur l'IHM EPCB, le statut de transaction devra être récupéré grâce à l'ID de transaction. Cet appel permettra aussi de déclencher les actions suivantes : envoi du mail de notification, enregistrement du paiement CB, déclenchement des actions asynchrones",
                "operationId": "validatePaymentFacture",
                "parameters": [
                    {
                        "description": "Identifiant de l’application appelante (exemples: 'NECFE', 'AMP', 'ERB')",
                        "in": "header",
                        "name": "callerId",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "description": "Identifiant unique pour chaque requête permettant la traçabilité des informations de bout en bout et servant lors de l’enregistrement des logs FPC et des partenaires sud. Valeur à l'initiative de l'appelant. (Exemple de valeur générée en java avec la méthode UUID.randomUUID(): '92eaf49d-13cd-4520-b536-2dd0faa5341f')",
                        "in": "header",
                        "name": "traceId",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "description": "WEB, MOB ou identifiant teléconseiller eclair (exemples: 'MOBILE' pour un appel AMP ou NECFE depuis un smartphone, 'WEB' pour un appel NECFE depuis un ordinateur connecté à internet. Pour Eclair: '1101' pour une boutique Orange, '1102' pour le service client, '1103' pour le site orange.fr)",
                        "in": "header",
                        "name": "channel",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "in": "path",
                        "name": "paymentProcessId",
                        "required": true,
                        "type": "string",
                        "description": "ID de la ressource"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/TransactionStatusResponse"
                        },
                        "headers": {
                            "X-Orange-FPC-Last-Payment-Available": {
                                "description": "Enregistrement correct du paiement en database (true=oui, false=non)",
                                "type": "boolean"
                            }
                        }
                    },
                    "400": {
                        "description": "Erreur sur la requête (champs manquants, mauvais paramétrages des données...etc)",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "500": {
                        "description": "Erreur technique",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "501": {
                        "description": "Demande d'autorisation KO",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "503": {
                        "description": "Serveur indisponible (maintenance ou nombre d'appels trop important).",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    }
                },
                "summary": "Validation du paiement.",
                "tags": [
                    "paymentProcesses"
                ]
            }
        },
        "/paymentProcesses/": {
            "get": {
                "description": "Récupération des données des ressources de paiement et des états d'avancement des paiements",
                "operationId": "getPaymentFacture",
                "parameters": [
                    {
                        "description": "Identifiant de l’application appelante (exemples: 'NECFE', 'AMP', 'ERB')",
                        "in": "header",
                        "name": "callerId",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "description": "Identifiant unique pour chaque requête permettant la traçabilité des informations de bout en bout et servant lors de l’enregistrement des logs FPC et des partenaires sud. Valeur à l'initiative de l'appelant. (Exemple de valeur générée en java avec la méthode UUID.randomUUID(): '92eaf49d-13cd-4520-b536-2dd0faa5341f')",
                        "in": "header",
                        "name": "traceId",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "description": "WEB, MOB ou identifiant teléconseiller eclair (exemples: 'MOBILE' pour un appel AMP ou NECFE depuis un smartphone, 'WEB' pour un appel NECFE depuis un ordinateur connecté à internet. Pour Eclair: '1101' pour une boutique Orange, '1102' pour le service client, '1103' pour le site orange.fr)",
                        "in": "header",
                        "name": "channel",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "in": "query",
                        "name": "paymentProcessId",
                        "required": false,
                        "type": "string",
                        "description": "ID de la ressource"
                    },
                    {
                        "description": "Type identifiant de contrat Orange",
                        "in": "query",
                        "name": "contractKeyType",
                        "required": false,
                        "type": "string",
                        "default": "mobilePhoneNumber",
                        "enum": [
                            "mobilePhoneNumber",
                            "fixedLineNumber",
                            "internetAccount"
                        ]
                    },
                    {
                        "description": "Identifiant contrat Orange (numéro tel mobile, numéro tel fixe, compte internet)",
                        "in": "query",
                        "name": "contractKey",
                        "required": false,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/Payment"
                            }
                        },
                        "headers": {
                            "location": {
                                "description": "ID de la ressource",
                                "type": "string"
                            }
                        }
                    },
                    "400": {
                        "description": "Erreur sur la requête (champs manquants, mauvais paramétrages des données...etc)",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "500": {
                        "description": "Erreur technique",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "503": {
                        "description": "Serveur indisponible (maintenance ou nombre d'appels trop important).",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    }
                },
                "summary": "Récupération des données des ressources de paiement et des états d'avancement des paiements.",
                "tags": [
                    "paymentProcesses"
                ]
            }
        }
    },
    "definitions": {
        "CustomerPaymentSummary": {
            "description": "données concernant le paiement.",
            "properties": {
                "isCbCurrentBillPaid": {
                    "description": "Booleen indiquant la réalisation d’un paiement par CB sur l’espace client pour la dernière facture",
                    "type": "boolean"
                },
                "cbCurrentBillPaidAmount": {
                    "description": "Montant du paiement par CB sur l’espace client de la dernière facture",
                    "format": "float",
                    "type": "number"
                },
                "cbCurrentBillPaidDate": {
                    "description": "Date du paiement par CB sur l’espace client de la dernière facture",
                    "type": "string",
                    "format": "date"
                },
                "isCbLastBillPaid": {
                    "description": "Booleen indiquant la réalisation d’un paiement par CB sur l’espace client pour l’avant dernière facture",
                    "type": "boolean"
                },
                "cbLastBillPaidAmount": {
                    "description": "Montant du paiement par CB sur l’espace client de l’avant dernière facture",
                    "format": "float",
                    "type": "number"
                },
                "cbLastBillPaidDate": {
                    "description": "Date du paiement par CB sur l’espace client de l’avant dernière facture",
                    "type": "string",
                    "format": "date"
                },
                "isLastDueDateReached": {
                    "description": "Indicateur permettant de savoir si la date limite de paiement est dépassée pour la dernière facture",
                    "type": "boolean"
                },
                "isLastExtendedDueDateReached": {
                    "description": "Indicateur permettant de savoir si la date limite de paiement est dépassée de X Jours pour la dernière facture",
                    "type": "boolean"
                },
                "isExtendedBillDateNotReached": {
                    "description": "Indicateur permettant de savoir si la date de la facture a été dépassée de Z jours",
                    "type": "boolean"
                },
                "isPrelLastBillNotDone": {
                    "description": "Indicateur permettant de savoir si un paiement a été effectué sous les Z jours après émission de la facture",
                    "type": "boolean"
                },
                "paymentCaseNumber": {
                    "description": "Cas de paiement",
                    "type": "string"
                },
                "pushType": {
                    "description": "Type de push à pousser au client",
                    "type": "string",
                    "enum": [
                        "FE",
                        "PREL",
                        "FEPREL",
                        "NONE"
                    ]
                },
                "payableAmount": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/PayableAmount"
                    }
                }
            }
        },
        "PayableAmount": {
            "description": "données concernant le paiement.",
            "properties": {
                "type": {
                    "description": "Type de paiement pouvant être effectué",
                    "type": "string",
                    "enum": [
                        "billTotalAmount",
                        "currentResidualAmount",
                        "balanceCarriedForward"
                    ]
                },
                "amount": {
                    "description": "Montant que le client peut payer",
                    "type": "number",
                    "format": "float"
                },
                "action": {
                    "description": "Montant que le client s'apprête à payer",
                    "type": "string",
                    "enum": [
                        "PAY",
                        "REG",
                        "PAY_REG"
                    ]
                }
            }
        },
        "PaymentRessourceInit": {
            "description": "Appel pour l'initialisation du paiement",
            "properties": {
                "backUrl": {
                    "description": "URL de retour",
                    "type": "string"
                },
                "cancelUrl": {
                    "description": "URL d'annulation",
                    "type": "string"
                },
                "contractKeyType": {
                    "description": "Type identifiant de contrat Orange",
                    "type": "string"
                },
                "contractKey": {
                    "description": "Type d'identifiant  (numéro de mobile, numéro de fixe, compte internet)",
                    "type": "string"
                },
                "pid": {
                    "description": "Identifiant client",
                    "type": "string"
                },
                "emailAddress": {
                    "description": "Adresse mail du client",
                    "type": "string"
                },
                "isSar": {
                    "description": "Indicateur permettant de savoir si le client est en SAR",
                    "type": "boolean"
                },
                "amountToPay": {
                    "description": "Montant que le client s'apprête à payer",
                    "type": "number",
                    "format": "float"
                },
                "amountType": {
                    "description": "Type de montant à payer",
                    "type": "string",
                    "enum": [
                        "billTotalAmount",
                        "currentResidualAmount",
                        "balanceCarriedForward"
                    ]
                }
            }
        },
        "Payment": {
            "description": "Données de la ressource récupérées",
            "properties": {
                "billDate": {
                    "description": "Date de la facture",
                    "format": "date",
                    "type": "string"
                },
                "billReference": {
                    "description": "Référence de la facture à payer",
                    "type": "string"
                },
                "amountToPay": {
                    "description": "Montant payé ou qui va être payé par le client",
                    "type": "number",
                    "format": "float"
                },
                "cpop": {
                    "description": "Certificat de prise en compte d'une opération de paiement",
                    "type": "string"
                },
                "paymentDate": {
                    "description": "Date de paiement de la facture",
                    "type": "string",
                    "format": "date"
                },
                "amountType": {
                    "description": "Type de montant à payer",
                    "type": "string",
                    "enum": [
                        "billTotalAmount",
                        "currentResidualAmount",
                        "balanceCarriedForward"
                    ]
                },
                "paymentCaseNumber": {
                    "description": "Cas de paiement",
                    "type": "string"
                },
                "emailAddress": {
                    "description": "Adresse mail du client",
                    "type": "string"
                },
                "paymentProcessStatus": {
                    "$ref": "#/definitions/PaymentProcessStatus"
                }
            }
        },
        "PaymentProcessStatus": {
            "description": "Montants payables par le client",
            "properties": {
                "isDaAlreadyDone": {
                    "description": "Indicateur permettant de savoir si la demande d’autorisation a déjà été réalisée",
                    "type": "boolean"
                },
                "lineRecovered": {
                    "description": "Demandes de marquage de la facture et rétablissement de la ligne effectuées",
                    "type": "string",
                    "enum": [
                        "batchNotStarted",
                        "ok",
                        "ko",
                        "delayExceeded",
                        "inputParametersKo"
                    ]
                },
                "emailSent": {
                    "description": "Demande d'envoi du mail de notification au client effectuée",
                    "type": "string",
                    "enum": [
                        "batchNotStarted",
                        "ok",
                        "ko",
                        "delayExceeded",
                        "inputParametersKo"
                    ]
                },
                "moneyTransfered": {
                    "description": "Demande de remise effectuée",
                    "type": "string",
                    "enum": [
                        "batchNotStarted",
                        "ok",
                        "ko",
                        "delayExceeded",
                        "inputParametersKo"
                    ]
                },
                "isPaymentSaved": {
                    "description": "Enregistrement du paiement en base de données",
                    "type": "boolean"
                },
                "isDemandExceeded": {
                    "description": "Indicateur permettant de savoir si une action post paiement a échoué",
                    "type": "boolean"
                }
            }
        },
        "TransactionStatusResponse": {
            "description": "Réponse de la récupération du statut de transaction",
            "properties": {
                "amountPaid": {
                    "description": "Montant payé par le client",
                    "type": "number",
                    "format": "float"
                },
                "cpop": {
                    "description": "Certificat de prise en compte d'une opération de paiement",
                    "type": "string"
                },
                "paymentDate": {
                    "description": "Date de paiement",
                    "type": "string",
                    "format": "date"
                }
            }
        },
        "PaymentInitializationResponse": {
            "description": "Appel pour l'initialisation du paiement",
            "properties": {
                "paymentUrl": {
                    "description": "URL de redirection vers EPCB IHM pour effectuer effectuer le paiement",
                    "type": "string"
                }
            }
        },
        "Error": {
            "required": [
                "code",
                "message"
            ],
            "properties": {
                "code": {
                    "description": "Code applicatif de l'erreur",
                    "format": "int32",
                    "type": "integer"
                },
                "message": {
                    "description": "Message technique à destination des développeur, clients de l'API",
                    "type": "string"
                },
                "description": {
                    "description": "Description de l'erreur",
                    "type": "string"
                },
                "infoURL": {
                    "description": "URL menant vers une explication de l'erreur",
                    "type": "string"
                }
            }
        }
    }
}